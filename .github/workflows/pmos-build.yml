name: Build postmarketOS for Samsung Goyawifi (Manual)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Build custom Docker image
        run: docker build -t pmbootstrap-custom .

      - name: Run pmbootstrap in Docker
        run: |
          docker run --rm -v $(pwd):/pmbootstrap -w /pmbootstrap pmbootstrap-custom /bin/bash -c "
          ./pmbootstrap.py init &&
          echo 'y' | ./pmbootstrap.py config device samsung-goyawifi &&
          ./pmbootstrap.py zap &&
          ./pmbootstrap.py install --android-recovery-zip --recovery-install-partition=data &&
          ./pmbootstrap.py export
          "

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: pmos-samsung-goyawifi
          path: /tmp/postmarketOS-export/pmos-samsung-goyawifi.zip
